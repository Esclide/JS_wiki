ACID и BASE

Это стандарт того, какие гарантии должна давать база данных, чтобы поддерживать транзакции, без деталей реализации.

A - Атомарность. Либо транзакция выполняется полностью, либо полностью откатывается, нельзя выполнить частично

C - согласованность (консистентность) - в данном контексте не то, что в основном имеется в виду. базы данных имеют constraints - правила, применяемые к сохраняемым данным (первичные ключи, индексы, типы и т.п.) Согласованность - гарантия, что при сохранении данных эти правила будут выполнены

I в ASID - Изоляция. Изоляция транзакции определяет поведение транзакции в случае конкуррентности, т.е. в случае параллельно запущенных запросов, которые пытаются получить доступ к одним и тем же данным. Самый важный принцип в ACID

D - durability (надежность) - системный сбой не должен приводить к потере результатов транзакции или собержимого базы. Т.е. если нам пришел ответ, что транзакиця прошла, значит, данные уже зафиксировались в памяти.

На почве ACID появились популярные реляционные БД

NoSQL базы данных

NoSQL базы данных неплохо справляются и без ACID, не запариваясь насчет транзакций и их надежности. NoSQL - это абстракция, базы данных отличаются между собой (и документо-ориентированные, и графовые)

Они предоставляют ограниченные версии атомарности и изоляции. Для них есть другая аббревиатура - BASE. Вместо гарантии изоляции они предлагают "eventual consistency", т.е. согласованность в конечном счете, т.е. в конце-концов мы увидим правильные данные, но есть шанс, что транзакция прочитает "грязные" данные

NoSQL - БД для аналитики, им важна больше скорость, чем консистентность

Тут консистеностность определяется как то, что данные на разных инстансах не противоречат друг другу

базы NoSQL зачастую отказываются от согласованности в контексте теоремы CAP, что описывает следующую ситуацию: данные были обновлены в кластере с несколькими instances, но изменения были синхронизированы ещё не на всех instances. Нужно время, чтобы обновить везде

Подобная временная несогласованность (т.е. согласованность в конечном счёте) может приключиться и с кластером реляционной БД – ведь эта согласованность не имеет ничего общего с согласованностью из ACID. Поэтому важно понимать, что в этом смысле БД SQL и NoSQL вряд ли будут сильно отличаться, если речь идёт о нескольких instances в кластере.

BA - базовая доступность - жертвуя консистентностью, мы стараемся обеспечить как можно большую базовую доступность
S - soft state - состояние системы может меняться со временем даже без вводных данных
E - eventual consistency - согласованность в конечном счете

Не-ACID база данных

- не гарантирует атомарность (хотя у некоторых есть отдельная API для таких операций)
- не гарантирует изоляцию (например, данные могут быть записаны не в том порядке)


В распределенных системах ACID необходимо настраивать отдельно, даже если каждая отдельная БД ACID

Техники для осуществления транзакций на стороне приложения:Оптимистичная блокировка - (пересечеений почти не будет) читает нужную строку, запоминает номер её версии и перед тем, как записать в БД изменения для этих данных, проверяет, не изменилась ли версия этих данных. Если версия изменилась, то нужно как-то решить создавшийся конфликт и обновить данные (“commit”), либо откатить транзакцию (“rollback”). Минус - возможен баг, когда состояние изменилось после проверки, но перед записью

Пессимистичная блокировка - (конфликты будут встречаться часто) блокирует необходимые данные. нужно либо поддерживать соединение с БД для вашей сессии. либо использовать ID для транзакции, которая может быть использована независимо от соединения. Минус пессимистичной блокировки в том, что её использование замедляет обработку транзакций в целом, но зато вы можете быть спокойны за данные и получаете настоящую изоляцию. Дополнительная опасность - deadlock, когда ресурсы ждут освобождения ресурсов друг друга. Решается созданием иерархии блокировок

Когда нужен ACID

- Когда есть большая вероятность того, что некое множество пользователей или процессов будет одновременно работать над одними и теми же данными. (пр: финансовые операции)
- Когда порядок выполнения транзакций имеет значение.
- Когда нельзя выдать пользователю или процессу устаревшие данные.

Когда не нужен
- Когда пользователи обновляют лишь некие свои приватные данные.
- Когда пользователи вообще не обновляют данные, а только дополняют новыми (append).
- Когда бизнес-логика не определяет необходимость некоего порядка выполнения транзакций.
- Когда пользователи будут пребывать на одной и той же веб-странице или окне приложения несколько секунд или даже минут, и поэтому они так или иначе будут видеть устаревшие данные.
- Когда для вас не имеет значения, что в системе временно могут хранится неполные транзакции - вы можете их игнорировать без всякого ущерба.



